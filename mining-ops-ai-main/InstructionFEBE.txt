==================================================================================
HANDOFF DOCUMENT: MINING OPS AI SYSTEM (V3.0 FINAL)
==================================================================================

Dokumen ini adalah panduan integrasi untuk sistem "Mining Value Chain Optimizer".
Sistem ini menggabungkan simulasi fisik, prediksi machine learning, dan
Generative AI (Ollama) untuk memberikan rekomendasi strategi tambang.

==================================================================================
BAGIAN 1: ISI FILE
==================================================================================

Pastikan struktur folder di server Anda persis seperti ini:

/root_project/
|-- api.py                 (SERVER UTAMA - Jalankan file ini)
|-- simulator.py           (CORE ENGINE - Logika Simulasi & AI)
|-- requirements.txt       (DEPENDENCIES - Daftar library)
|
|-- data/                  (DATABASE CSV - Wajib ada & bisa di-update)
|   |-- trucks.csv
|   |-- excavators.csv
|   |-- operators.csv
|   |-- road_segments.csv
|   |-- sailing_schedules.csv  <-- (Data Jadwal Kapal)
|   |-- vessels.csv            <-- (Data Master Kapal)
|   |-- maintenance_logs.csv
|
|-- models/                (MODEL ML - Jangan diubah)
|   |-- model_fuel.joblib
|   |-- model_load_weight.joblib
|   |-- model_delay_probability.joblib
|   |-- numerical_columns.json
|   |-- categorical_columns.json

==================================================================================
BAGIAN 2: PANDUAN BACK-END (DEPLOYMENT)
==================================================================================

1. PRASYARAT SERVER (OLLAMA)
   Sistem ini membutuhkan LLM lokal.
   - Instal Ollama: https://ollama.com/download
   - Jalankan server Ollama: `ollama serve`
   - Download Model: `ollama pull `qwen2.5:7b`

2. INSTALASI PYTHON
   - Buat virtual environment (disarankan).
   - Instal library: `pip install -r requirements.txt`

3. MENJALANKAN API
   - Gunakan Uvicorn:
     >> uvicorn api:app --host 0.0.0.0 --port 8000

4. API DOCUMENTATION (SWAGGER)
   - Setelah server jalan, buka: `http://localhost:8000/docs`
   - Gunakan halaman ini untuk testing manual.

==================================================================================
BAGIAN 3: PANDUAN FRONT-END (INTEGRASI UI)
==================================================================================

Aplikasi FE harus memiliki fitur input parameter, tampilan kartu hasil,
dan chatbox interaktif.

---
ENDPOINT 1: DAPATKAN REKOMENDASI STRATEGI
---
* **URL:** `POST /get_top_3_strategies`
* **Tujuan:** Mengirim kondisi lapangan untuk disimulasikan.
* **Payload JSON (Request):**

    {
      "fixed_conditions": {
        "weatherCondition": "Hujan Ringan",    // Pilihan: Cerah, Hujan Ringan, Hujan Lebat
        "roadCondition": "FAIR",               // Pilihan: GOOD, FAIR, POOR, LICIN
        "shift": "SHIFT_1",
        "target_road_id": "cmhsbjn...",        // ID Rute (dari database)
        "target_excavator_id": "cmhsbjp...",   // ID Excavator (dari database)
        "target_schedule_id": "cmhsbjs...",    // ID Jadwal Kapal (dari database)
        "simulation_start_date": "2025-11-14T08:00:00Z" // (Opsional) Waktu mulai
      },
      "decision_variables": {
        "alokasi_truk": [5, 10, 15],           // Opsi jumlah truk yg dites
        "jumlah_excavator": [1, 2]             // Opsi jumlah exc yg dites
      },
      "financial_params": {                    // (OPSIONAL - FITUR WHAT IF)
        "HargaJualBatuBara": 800000,
        "HargaSolar": 15000,
        "BiayaPenaltiKeterlambatanKapal": 100000000,
        "BiayaDemurragePerJam": 50000000
      }
    }

* **Response JSON (Data untuk UI):**
    Server akan mengembalikan List berisi 3 strategi terbaik.
    Gunakan data ini untuk membuat 3 Kartu/Container.

    {
      "top_3_strategies": [
        {
          "OPSI_1": {
            "TYPE": "REKOMENDASI UTAMA",
            "KPI_PREDIKSI": {
               "PROFIT": "857 Juta IDR",
               "PRODUKSI": "1,537 Ton",
               "FUEL_RATIO": "0.83 L/Ton",
               "IDLE_ANTRIAN": "3.6 Jam"
            },
            "INSTRUKSI_FLAT": {
               "JUMLAH_DUMP_TRUCK": "10 Unit",
               "ALAT_MUAT_TARGET": "PIT-01 (Unit: Kobelco...)",
               "JALUR_ANGKUT": "Pit 1 ke Stockpile (3.5 km)"
            },
            "ANALISIS_KAPAL": "Kapal: MV Coal | Status: DELAY_RISK | Denda: 50 Juta",
            "SOP_KESELAMATAN": "SLIPPERY: Batasi kecepatan..."
          }
        },
        ... (Opsi 2 & 3)
      ]
    }

    *** PENTING: Simpan seluruh Response JSON ini di state aplikasi FE sebagai 'KONTEKS'.

---
ENDPOINT 2: CHATBOT AI (Q&A)
---
* **URL:** `POST /ask_chatbot`
* **Tujuan:** User bertanya detail tentang strategi di atas.
* **Payload JSON (Request):**

    {
      "pertanyaan_user": "Kenapa strategi 1 profitnya paling tinggi?",
      "top_3_strategies_context": [ ...MASUKKAN JSON DARI RESPONSE SEBELUMNYA DI SINI... ]
    }

* **Response JSON:**
    {
      "jawaban_ai": "Strategi 1 memiliki profit tertinggi karena volume produksinya (1.537 Ton) jauh melampaui biaya operasionalnya..."
    }

---
ENDPOINT 3 & 4: MANAJEMEN DATA (ADMIN PANEL)
---
Gunakan ini jika User ingin menambah data tanpa menyentuh CSV.
* `POST /add_vessel` (Nama Kapal, Kapasitas)
* `POST /add_schedule` (ETA, ETD, Target Muatan)

==================================================================================
CATATAN KHUSUS LOGISTIK KAPAL
==================================================================================
Jika User memilih jadwal kapal yang deadline-nya sudah dekat (atau lewat),
Output "PROFIT" mungkin bernilai NEGATIF (karena denda Demurrage).
Tampilkan status ini dengan warna MERAH di UI ("Risk Alert").

==================================================================================
Jika API merespon "500 Error", cek terminal server untuk log detailnya.
Pastikan file CSV di folder /data tidak korup/kosong.