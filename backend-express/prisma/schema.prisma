generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  username  String   @unique
  email     String?  @unique
  password  String
  fullName  String
  role      Role     @default(SUPERVISOR)
  isActive  Boolean  @default(true)
  lastLogin DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  operatorProfile       Operator?
  haulingActivities     HaulingActivity[]
  incidentReports       IncidentReport[]
  chatbotInteractions   ChatbotInteraction[]
  recommendationLogs    RecommendationLog[]
  systemConfigUpdates   SystemConfig[]
  
  @@map("users")
}

enum Role {
  ADMIN
  SUPERVISOR
  OPERATOR
  DISPATCHER
  MAINTENANCE_STAFF
}

model MiningSite {
  id          String   @id @default(cuid())
  code        String   @unique
  name        String
  siteType    SiteType
  isActive    Boolean  @default(true)
  latitude    Float?
  longitude   Float?
  elevation   Float?
  capacity    Float?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  loadingPoints     LoadingPoint[]
  dumpingPoints     DumpingPoint[]
  roadSegments      RoadSegment[]
  weatherLogs       WeatherLog[]
  productionRecords ProductionRecord[]
  
  @@map("mining_sites")
}

enum SiteType {
  PIT
  STOCKPILE
  CRUSHER
  PORT
  COAL_HAULING_ROAD
  ROM_PAD
}

model LoadingPoint {
  id            String     @id @default(cuid())
  code          String     @unique
  name          String
  miningSiteId  String
  excavatorId   String?
  isActive      Boolean    @default(true)
  maxQueueSize  Int        @default(5)
  latitude      Float?
  longitude     Float?
  coalSeam      String?
  coalQuality   Json?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  
  miningSite        MiningSite        @relation(fields: [miningSiteId], references: [id])
  excavator         Excavator?        @relation(fields: [excavatorId], references: [id])
  haulingActivities HaulingActivity[]
  queueLogs         QueueLog[]
  
  @@map("loading_points")
}

model DumpingPoint {
  id           String   @id @default(cuid())
  code         String   @unique
  name         String
  miningSiteId String
  dumpingType  DumpingType
  isActive     Boolean  @default(true)
  capacity     Float?
  currentStock Float    @default(0)
  latitude     Float?
  longitude    Float?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  miningSite        MiningSite        @relation(fields: [miningSiteId], references: [id])
  haulingActivities HaulingActivity[]
  
  @@map("dumping_points")
}

enum DumpingType {
  STOCKPILE
  CRUSHER
  WASTE_DUMP
  ROM_STOCKPILE
  PORT
}

model RoadSegment {
  id              String       @id @default(cuid())
  code            String       @unique
  name            String
  miningSiteId    String
  startPoint      String
  endPoint        String
  distance        Float
  roadCondition   RoadCondition @default(GOOD)
  maxSpeed        Int          @default(30)
  gradient        Float?
  isActive        Boolean      @default(true)
  lastMaintenance DateTime?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  
  miningSite        MiningSite        @relation(fields: [miningSiteId], references: [id])
  haulingActivities HaulingActivity[]
  
  @@map("road_segments")
}

enum RoadCondition {
  EXCELLENT
  GOOD
  FAIR
  POOR
  CRITICAL
}

model Truck {
  id               String         @id @default(cuid())
  code             String         @unique
  name             String
  brand            String?
  model            String?
  yearManufacture  Int?
  capacity         Float
  fuelCapacity     Float?
  fuelConsumption  Float?         @default(1.0) // L/km
  averageSpeed     Float          @default(30.0) // km/h
  maintenanceCost  Float?         @default(0.0) // Cost per hour
  status           TruckStatus    @default(IDLE)
  lastMaintenance  DateTime?
  nextMaintenance  DateTime?
  totalHours       Int            @default(0)
  totalDistance    Float          @default(0)
  currentOperatorId String?
  currentLocation  String?
  isActive         Boolean        @default(true)
  purchaseDate     DateTime?
  retirementDate   DateTime?
  remarks          String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  
  currentOperator       Operator?          @relation(fields: [currentOperatorId], references: [id])
  haulingActivities     HaulingActivity[]
  maintenanceLogs       MaintenanceLog[]
  fuelConsumptions      FuelConsumption[]
  incidentReports       IncidentReport[]
  equipmentStatusLogs   EquipmentStatusLog[]
  
  @@map("trucks")
}

enum TruckStatus {
  IDLE
  HAULING
  LOADING
  DUMPING
  IN_QUEUE
  MAINTENANCE
  BREAKDOWN
  REFUELING
  STANDBY
  OUT_OF_SERVICE
}

model Excavator {
  id               String            @id @default(cuid())
  code             String            @unique
  name             String
  brand            String?
  model            String?
  yearManufacture  Int?
  bucketCapacity   Float?
  productionRate   Float?          @default(5.0) // tons/minute
  fuelConsumption  Float?          @default(50.0) // L/hour
  maintenanceCost  Float?          @default(0.0) // Cost per hour
  status           ExcavatorStatus   @default(ACTIVE)
  lastMaintenance  DateTime?
  nextMaintenance  DateTime?
  totalHours       Int               @default(0)
  currentLocation  String?
  isActive         Boolean           @default(true)
  purchaseDate     DateTime?
  retirementDate   DateTime?
  remarks          String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  
  loadingPoints         LoadingPoint[]
  haulingActivities     HaulingActivity[]
  maintenanceLogs       MaintenanceLog[]
  fuelConsumptions      FuelConsumption[]
  incidentReports       IncidentReport[]
  equipmentStatusLogs   EquipmentStatusLog[]
  
  @@map("excavators")
}

enum ExcavatorStatus {
  ACTIVE
  IDLE
  MAINTENANCE
  BREAKDOWN
  STANDBY
  OUT_OF_SERVICE
}

model SupportEquipment {
  id               String                  @id @default(cuid())
  code             String                  @unique
  name             String
  equipmentType    SupportEquipmentType
  brand            String?
  model            String?
  status           SupportEquipmentStatus  @default(ACTIVE)
  lastMaintenance  DateTime?
  totalHours       Int                     @default(0)
  isActive         Boolean                 @default(true)
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @updatedAt
  
  maintenanceLogs       MaintenanceLog[]
  fuelConsumptions      FuelConsumption[]
  equipmentStatusLogs   EquipmentStatusLog[]
  
  @@map("support_equipment")
}

enum SupportEquipmentType {
  GRADER
  WATER_TRUCK
  FUEL_TRUCK
  DOZER
  COMPACTOR
  LIGHT_VEHICLE
}

enum SupportEquipmentStatus {
  ACTIVE
  IDLE
  MAINTENANCE
  BREAKDOWN
  OUT_OF_SERVICE
}

model Operator {
  id              String       @id @default(cuid())
  userId          String       @unique
  employeeNumber  String       @unique
  licenseNumber   String?
  licenseType     LicenseType
  licenseExpiry   DateTime?
  competency      Json?
  status          OperatorStatus @default(ACTIVE)
  shift           Shift?
  totalHours      Int          @default(0)
  rating          Float?       @default(5.0)
  salary          Float        @default(0)
  joinDate        DateTime
  resignDate      DateTime?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  
  user                  User                @relation(fields: [userId], references: [id])
  trucks                Truck[]
  haulingActivities     HaulingActivity[]
  excavatorHaulingActivities HaulingActivity[] @relation("HaulingExcavatorOperator")
  incidentReports       IncidentReport[]
  
  @@map("operators")
}

enum LicenseType {
  SIM_A
  SIM_B1
  SIM_B2
  OPERATOR_ALAT_BERAT
}

enum OperatorStatus {
  ACTIVE
  ON_LEAVE
  SICK
  RESIGNED
  SUSPENDED
}

enum Shift {
  SHIFT_1
  SHIFT_2
  SHIFT_3
}

model HaulingActivity {
  id                    String              @id @default(cuid())
  activityNumber        String              @unique
  
  truckId               String
  excavatorId           String?             // Made optional - excavator is not always required
  operatorId            String
  excavatorOperatorId   String?
  supervisorId          String
  
  loadingPointId        String
  dumpingPointId        String
  roadSegmentId         String?
  
  shift                 Shift
  queueStartTime        DateTime?
  queueEndTime          DateTime?
  loadingStartTime      DateTime
  loadingEndTime        DateTime?
  departureTime         DateTime?
  arrivalTime           DateTime?
  dumpingStartTime      DateTime?
  dumpingEndTime        DateTime?
  returnTime            DateTime?
  
  queueDuration         Int                 @default(0)
  loadingDuration       Int                 @default(0)
  haulingDuration       Int                 @default(0)
  dumpingDuration       Int                 @default(0)
  returnDuration        Int                 @default(0)
  totalCycleTime        Int                 @default(0)
  
  loadWeight            Float
  targetWeight          Float
  loadEfficiency        Float?
  distance              Float
  fuelConsumed          Float?
  
  status                HaulingStatus       @default(LOADING)
  weatherCondition      String?
  roadCondition         RoadCondition       @default(GOOD)
  
  isDelayed             Boolean             @default(false)
  delayMinutes          Int                 @default(0)
  delayReasonId         String?
  delayReasonDetail     String?
  
  predictedDelayRisk    String?
  predictedDelayMinutes Int?
  
  remarks               String?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  truck         Truck           @relation(fields: [truckId], references: [id])
  excavator     Excavator?      @relation(fields: [excavatorId], references: [id])
  operator      Operator        @relation(fields: [operatorId], references: [id])
  excavatorOperator Operator?    @relation("HaulingExcavatorOperator", fields: [excavatorOperatorId], references: [id])
  supervisor    User            @relation(fields: [supervisorId], references: [id])
  loadingPoint  LoadingPoint    @relation(fields: [loadingPointId], references: [id])
  dumpingPoint  DumpingPoint    @relation(fields: [dumpingPointId], references: [id])
  roadSegment   RoadSegment?    @relation(fields: [roadSegmentId], references: [id])
  delayReason   DelayReason?    @relation(fields: [delayReasonId], references: [id])
  
  @@index([truckId, loadingStartTime])
  @@index([shift, loadingStartTime])
  @@index([status])
  @@map("hauling_activities")
}

enum HaulingStatus {
  PLANNED
  IN_QUEUE
  LOADING
  HAULING
  DUMPING
  RETURNING
  COMPLETED
  DELAYED
  CANCELLED
  INCIDENT
}

model QueueLog {
  id              String       @id @default(cuid())
  loadingPointId  String
  truckId         String?
  queueLength     Int
  queueStartTime  DateTime
  queueEndTime    DateTime?
  waitingTime     Int?
  timestamp       DateTime     @default(now())
  
  loadingPoint LoadingPoint @relation(fields: [loadingPointId], references: [id])
  
  @@index([loadingPointId, timestamp])
  @@map("queue_logs")
}

model ProductionRecord {
  id              String   @id @default(cuid())
  recordDate      DateTime @db.Date
  shift           Shift
  miningSiteId    String
  
  targetProduction Float
  actualProduction Float
  achievement     Float
  
  avgCalori       Float?
  avgAshContent   Float?
  avgSulfur       Float?
  avgMoisture     Float?
  
  totalTrips      Int      @default(0)
  totalDistance   Float    @default(0)
  totalFuel       Float    @default(0)
  avgCycleTime    Float?
  
  trucksOperating Int      @default(0)
  trucksBreakdown Int      @default(0)
  excavatorsOperating Int  @default(0)
  excavatorsBreakdown Int  @default(0)
  
  downtimeHours   Float    @default(0)
  utilizationRate Float?
  
  equipmentAllocation Json?

  remarks         String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  miningSite MiningSite @relation(fields: [miningSiteId], references: [id])
  
  @@unique([recordDate, shift, miningSiteId])
  @@index([recordDate])
  @@map("production_records")
}

model WeatherLog {
  id            String        @id @default(cuid())
  timestamp     DateTime      @default(now())
  miningSiteId  String?
  
  condition     WeatherCondition
  temperature   Float?
  humidity      Float?
  windSpeed     Float?
  windDirection String?
  rainfall      Float?
  visibility    Visibility    @default(GOOD)
  
  waveHeight    Float?
  seaCondition  String?
  
  isOperational Boolean       @default(true)
  riskLevel     RiskLevel     @default(LOW)
  
  remarks       String?
  
  miningSite MiningSite? @relation(fields: [miningSiteId], references: [id])
  
  @@index([timestamp])
  @@index([miningSiteId, timestamp])
  @@map("weather_logs")
}

enum WeatherCondition {
  CERAH
  BERAWAN
  MENDUNG
  HUJAN_RINGAN
  HUJAN_SEDANG
  HUJAN_LEBAT
  BADAI
  KABUT
}

enum Visibility {
  EXCELLENT
  GOOD
  MODERATE
  POOR
  VERY_POOR
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

model MaintenanceLog {
  id                String            @id @default(cuid())
  maintenanceNumber String            @unique
  
  truckId           String?
  excavatorId       String?
  supportEquipmentId String?
  
  maintenanceType   MaintenanceType
  scheduledDate     DateTime?
  actualDate        DateTime
  completionDate    DateTime?
  
  duration          Int?
  cost              Float?
  
  description       String
  partsReplaced     Json?
  mechanicName      String?
  
  status            MaintenanceStatus @default(SCHEDULED)
  
  downtimeHours     Float             @default(0)
  
  remarks           String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  
  truck             Truck?            @relation(fields: [truckId], references: [id])
  excavator         Excavator?        @relation(fields: [excavatorId], references: [id])
  supportEquipment  SupportEquipment? @relation(fields: [supportEquipmentId], references: [id])
  
  @@index([actualDate])
  @@index([status])
  @@map("maintenance_logs")
}

enum MaintenanceType {
  PREVENTIVE
  CORRECTIVE
  PREDICTIVE
  OVERHAUL
  INSPECTION
}

enum MaintenanceStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  DELAYED
}

model IncidentReport {
  id              String         @id @default(cuid())
  incidentNumber  String         @unique
  incidentDate    DateTime
  reportDate      DateTime       @default(now())
  
  location        String
  miningSiteCode  String?
  
  truckId         String?
  excavatorId     String?
  
  reportedById    String
  operatorId      String?
  
  incidentType    IncidentType
  severity        Severity
  description     String
  rootCause       String?
  
  injuries        Int            @default(0)
  fatalities      Int            @default(0)
  equipmentDamage String?
  productionLoss  Float?
  estimatedCost   Float?
  downtimeHours   Float          @default(0)
  
  status          IncidentStatus @default(REPORTED)
  actionTaken     String?
  preventiveMeasure String?
  
  photos          Json?
  documents       Json?
  
  remarks         String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  truck       Truck?    @relation(fields: [truckId], references: [id])
  excavator   Excavator? @relation(fields: [excavatorId], references: [id])
  reportedBy  User      @relation(fields: [reportedById], references: [id])
  operator    Operator? @relation(fields: [operatorId], references: [id])
  
  @@index([incidentDate])
  @@index([severity])
  @@map("incident_reports")
}

enum IncidentType {
  ACCIDENT
  NEAR_MISS
  EQUIPMENT_FAILURE
  SPILL
  FIRE
  COLLISION
  ROLLOVER
  ENVIRONMENTAL
  SAFETY_VIOLATION
}

enum Severity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum IncidentStatus {
  REPORTED
  INVESTIGATING
  RESOLVED
  CLOSED
}

model FuelConsumption {
  id                  String   @id @default(cuid())
  consumptionDate     DateTime
  
  truckId             String?
  excavatorId         String?
  supportEquipmentId  String?
  
  fuelType            FuelType
  quantity            Float
  costPerLiter        Float?
  totalCost           Float?
  
  operatingHours      Float?
  distance            Float?
  fuelEfficiency      Float?
  
  fuelStation         String?
  
  remarks             String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  truck             Truck?            @relation(fields: [truckId], references: [id])
  excavator         Excavator?        @relation(fields: [excavatorId], references: [id])
  supportEquipment  SupportEquipment? @relation(fields: [supportEquipmentId], references: [id])
  
  @@index([consumptionDate])
  @@map("fuel_consumptions")
}

enum FuelType {
  SOLAR
  BENSIN
  PERTAMAX
}

model DelayReason {
  id          String   @id @default(cuid())
  code        String   @unique
  category    DelayCategory
  name        String
  description String?
  isActive    Boolean  @default(true)
  
  haulingActivities HaulingActivity[]
  
  @@map("delay_reasons")
}

enum DelayCategory {
  WEATHER
  EQUIPMENT
  QUEUE
  ROAD
  OPERATOR
  FUEL
  ADMINISTRATIVE
  SAFETY
  OTHER
}

model EquipmentStatusLog {
  id                  String    @id @default(cuid())
  timestamp           DateTime  @default(now())
  
  truckId             String?
  excavatorId         String?
  supportEquipmentId  String?
  
  previousStatus      String
  currentStatus       String
  statusReason        String?
  
  location            String?
  
  durationMinutes     Int?
  
  remarks             String?
  
  truck             Truck?            @relation(fields: [truckId], references: [id])
  excavator         Excavator?        @relation(fields: [excavatorId], references: [id])
  supportEquipment  SupportEquipment? @relation(fields: [supportEquipmentId], references: [id])
  
  @@index([timestamp])
  @@map("equipment_status_logs")
}

// ===== Vessel / Shipping Models =====

model Vessel {
  id                String        @id @default(cuid())
  code              String        @unique
  name              String
  vesselType        VesselType

  // Data Kapal
  gt                Float         // Gross Tonnage
  dwt               Float         // Deadweight Tonnage
  loa               Float?        // Length Overall (meter)

  // Kapasitas
  capacity          Float         // Kapasitas muat (ton)

  // Kepemilikan
  owner             String        // Pemilik kapal
  isOwned           Boolean       @default(false)

  // Status
  status            VesselStatus  @default(AVAILABLE)
  currentLocation   String?

  isActive          Boolean       @default(true)
  remarks           String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  sailingSchedules  SailingSchedule[]
  shipmentRecords   ShipmentRecord[]

  @@map("vessels")
}

enum VesselType {
  MOTHER_VESSEL
  BARGE
  TUG_BOAT
}

enum VesselStatus {
  AVAILABLE
  LOADING
  SAILING
  DISCHARGING
  MAINTENANCE
  CHARTERED
}

model SailingSchedule {
  id                String          @id @default(cuid())
  scheduleNumber    String          @unique
  vesselId          String

  voyageNumber      String

  loadingPort       String
  destination       String

  etaLoading        DateTime
  etsLoading        DateTime?
  etaDestination    DateTime?

  ataLoading        DateTime?
  loadingStart      DateTime?
  loadingComplete   DateTime?
  atsLoading        DateTime?
  ataDestination    DateTime?

  plannedQuantity   Float
  actualQuantity    Float?

  buyer             String
  contractNumber    String?

  status            SailingStatus   @default(SCHEDULED)

  remarks           String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  vessel            Vessel          @relation(fields: [vesselId], references: [id])
  shipmentRecords   ShipmentRecord[]

  @@index([vesselId])
  @@index([etaLoading])
  @@index([status])
  @@map("sailing_schedules")
}

enum SailingStatus {
  SCHEDULED
  STANDBY
  LOADING
  SAILING
  ARRIVED
  DISCHARGING
  COMPLETED
  CANCELLED
}

model ShipmentRecord {
  id                  String          @id @default(cuid())
  shipmentNumber      String          @unique
  vesselId            String
  sailingScheduleId   String?

  shipmentDate        DateTime
  loadingDate         DateTime?

  coalType            String
  quantity            Float

  calorie             Float?
  totalMoisture       Float?
  ashContent          Float?
  sulfurContent       Float?

  stockpileOrigin     String?

  buyer               String
  destination         String

  surveyorName        String?
  blNumber            String?
  coaNumber           String?

  freightCost         Float?
  totalFreight        Float?

  remarks             String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  vessel              Vessel          @relation(fields: [vesselId], references: [id])
  sailingSchedule     SailingSchedule? @relation(fields: [sailingScheduleId], references: [id])

  @@index([vesselId])
  @@index([shipmentDate])
  @@map("shipment_records")
}

model BargeLoadingLog {
  id                String          @id @default(cuid())
  loadingNumber     String          @unique

  vesselCode        String
  vesselName        String

  loadingDate       DateTime
  shift             Shift
  startTime         DateTime
  endTime           DateTime?

  stockpileSource   String
  quantity          Float

  loaderUsed        String?
  bargeTrips        Int             @default(0)

  weatherCondition  String?
  tidalCondition    String?

  delayMinutes      Int             @default(0)
  delayReason       String?

  remarks           String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  @@index([loadingDate])
  @@map("barge_loading_logs")
}

model JettyBerth {
  id                String          @id @default(cuid())
  code              String          @unique
  name              String
  portName          String

  maxVesselSize     Float?
  maxDraft          Float?

  hasConveyor       Boolean         @default(false)
  loadingCapacity   Float?

  isActive          Boolean         @default(true)
  remarks           String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  berthingLogs      BerthingLog[]

  @@map("jetty_berths")
}

model BerthingLog {
  id                String          @id @default(cuid())
  jettyBerthId      String
  vesselCode        String
  vesselName        String

  arrivalTime       DateTime
  berthingTime      DateTime?
  loadingStart      DateTime?
  loadingEnd        DateTime?
  departureTime     DateTime?

  draftArrival      Float?
  draftDeparture    Float?

  waitingTime       Int             @default(0)

  remarks           String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  jettyBerth        JettyBerth      @relation(fields: [jettyBerthId], references: [id])

  @@index([jettyBerthId])
  @@index([arrivalTime])
  @@map("berthing_logs")
}

// AI/ML Integration Models
model PredictionLog {
  id                String   @id @default(cuid())
  predictionType    String   // 'STRATEGIC_RECOMMENDATION', 'FUEL_PREDICTION', 'LOAD_PREDICTION', 'DELAY_PREDICTION'
  inputParameters   Json     // Parameters yang digunakan untuk prediksi
  results           Json     // Hasil prediksi/rekomendasi
  accuracy          Float?   // Akurasi model (jika tersedia)
  executionTime     Int?     // Waktu eksekusi dalam milidetik
  modelVersion      String?  // Versi model yang digunakan
  timestamp         DateTime @default(now())
  createdAt         DateTime @default(now())
  
  @@index([predictionType])
  @@index([timestamp])
  @@map("prediction_logs")
}

model ChatbotInteraction {
  id              String   @id @default(cuid())
  userId          String?
  sessionId       String   // Untuk tracking sesi conversation
  userQuestion    String   @db.Text
  aiResponse      String   @db.Text
  context         Json?    // Context yang digunakan (misal: top 3 strategies)
  responseTime    Int?     // Waktu response dalam milidetik
  rating          Int?     // User rating (1-5) untuk response
  timestamp       DateTime @default(now())
  createdAt       DateTime @default(now())
  
  user            User?    @relation(fields: [userId], references: [id])
  
  @@index([userId])
  @@index([sessionId])
  @@index([timestamp])
  @@map("chatbot_interactions")
}

model RecommendationLog {
  id                  String    @id @default(cuid())
  recommendationType  String    // 'STRATEGIC', 'OPERATIONAL', 'MAINTENANCE'
  scenario            Json      // Input scenario (weather, shift, targets, dll)
  recommendations     Json      // Array of recommendations dengan ranking
  selectedStrategy    Int?      // Index strategi yang dipilih user (0, 1, atau 2)
  selectedStrategyId  String?   // ID strategi yang dipilih
  implementedAt       DateTime? // Kapan strategi diimplementasikan
  implementedBy       String?   // User yang mengimplementasikan
  results             Json?     // Actual results setelah implementasi
  profitActual        Float?    // Profit aktual vs prediksi
  profitPredicted     Float?    // Profit yang diprediksi
  variance            Float?    // Selisih actual vs predicted
  feedback            String?   @db.Text
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  
  implementer         User?     @relation(fields: [implementedBy], references: [id])
  
  @@index([recommendationType])
  @@index([createdAt])
  @@index([implementedAt])
  @@map("recommendation_logs")
}

model ModelTrainingLog {
  id                String   @id @default(cuid())
  modelType         String   // 'FUEL', 'LOAD', 'DELAY'
  modelVersion      String   // Semantic versioning: 1.0.0, 1.1.0, dll
  trainingDataSize  Int      // Jumlah data yang digunakan untuk training
  trainingAccuracy  Float?   // Akurasi pada training set
  validationAccuracy Float?  // Akurasi pada validation set
  testAccuracy      Float?   // Akurasi pada test set
  hyperparameters   Json?    // Hyperparameters yang digunakan
  featureImportance Json?    // Feature importance dari model
  trainedAt         DateTime @default(now())
  trainedBy         String?  // User/system yang melakukan training
  status            String   @default("ACTIVE") // ACTIVE, DEPRECATED, ARCHIVED
  remarks           String?  @db.Text
  createdAt         DateTime @default(now())
  
  @@index([modelType])
  @@index([trainedAt])
  @@index([status])
  @@map("model_training_logs")
}

model SystemConfig {
  id          String   @id @default(cuid())
  configKey   String   @unique
  configValue String   @db.Text
  dataType    String   @default("STRING") // STRING, NUMBER, BOOLEAN, JSON
  category    String   // AI_SERVICE, ML_PARAMETERS, FINANCIAL, OPERATIONAL
  description String?  @db.Text
  isActive    Boolean  @default(true)
  updatedBy   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  updater     User?    @relation(fields: [updatedBy], references: [id])
  
  @@index([category])
  @@index([isActive])
  @@map("system_configs")
}
